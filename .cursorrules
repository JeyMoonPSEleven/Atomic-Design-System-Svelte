---
description: Reglas para el Sistema de Diseño SvelteKit + Tailwind v4 + Atomic
globs: 
  - src/**/*.svelte
  - src/**/*.ts
---

# Principios Clave del Framework
- Usa Svelte 5 (Runes) para todo el código nuevo.
- Usa SvelteKit para el enrutamiento y la carga de datos.
- Todo el código debe usar TypeScript.
- Usa Tailwind CSS v4 para todos los estilos.

# Svelte 5 (Runes)
- Estado reactivo: `let count = $state(0);` 
- Valores derivados: `let doubled = $derived(count * 2);` 
- Props: `let { children } = $props();` 
- Props bidireccionales: `let { bindableProp = $bindable() } = $props();` 
- Efectos secundarios: `$effect(() => {... });` 

# Tailwind CSS (¡CRÍTICO!)
- **PROHIBICIÓN DE @APPLY:** NUNCA uses la directiva `@apply` dentro de los bloques `<style>` de los componentes Svelte.
- **PREFERIR CLASES DE UTILIDAD:** Siempre usa clases de utilidad de Tailwind directamente en el marcado HTML.
- **USAR TOKENS SEMÁNTICOS:** Para estilos, prefiere usar las clases de utilidad generadas por nuestros tokens semánticos (ej. `bg-primary`, `text-text-default`, `border-border-default`) definidos en `src/app.css`.
- **MODO OSCURO:** El modo oscuro se maneja ÚNICAMENTE a través de la redefinición de tokens semánticos en `src/app.css` bajo la clase `.dark`.

# Arquitectura de Componentes (Patrón CVA)
- **CVA:** Todos los Átomos y Moléculas que requieran variantes deben usar el patrón `CVA (class-variance-authority)` + `tailwind-merge`.
- **HELPER CVA:** Utiliza el helper `$lib/utils/cva.ts` para definir variantes.
- **PROPS:** Los componentes deben aceptar una prop `class` que se fusiona con `twMerge`.
- **ATRIBUTOS:** Los componentes deben usar `{...rest}` para pasar `$$restProps` al elemento DOM raíz.
- **COMPOSICIÓN:** Las Moléculas y Organismos deben preferir `slots` sobre `props` para la composición de contenido.

# Estructura de Proyecto (Atomic Design)
- **ÁTOMOS:** `$lib/components/01-atoms` (Bloques de construcción básicos, ej. Button, Input)
- **MOLÉCULAS:** `$lib/components/02-molecules` (Composiciones de Átomos, ej. SearchForm)
- **ORGANISMOS:** `$lib/components/03-organisms` (Secciones de UI, ej. Header, Footer)
- **PLANTILLAS:** `$lib/components/04-templates` (Estructuras de página, ej. ArticleLayout) 
- **PÁGINAS:** `src/routes/**/+page.svelte` (Instancias de Plantillas con datos reales)
- **JERARQUÍA:** Los componentes solo pueden importar desde niveles atómicos inferiores (ej. Moléculas importan Átomos).

# Convenciones de Nombrado
- **Archivos de Componente:** `PascalCase` (ej. `Button.svelte`, `SearchForm.svelte`) 
- **Importaciones de Componente:** `PascalCase` (ej. `import SearchForm from...`) 
- **Variables y Funciones:** `camelCase` 

# Herramientas de Documentación (PROHIBIDAS)
- **PROHIBICIÓN DE HISTOIRE:** Este proyecto NO utiliza Histoire ni ninguna herramienta de catálogo de componentes (Storybook, etc.). Los componentes se prueban y documentan directamente en las páginas de la aplicación (`src/routes`).
- **RAZÓN:** Las herramientas de catálogo ralentizan el desarrollo y añaden complejidad innecesaria. La documentación y pruebas se realizan en contexto real dentro de la aplicación.
- **NO CREAR:** Nunca crear archivos `.story.svelte`, `histoire.config.ts`, ni instalar dependencias relacionadas con Histoire o Storybook.

# Patrón de Importación
- **JERARQUÍA:** Los componentes solo pueden importar desde niveles atómicos inferiores (ej. Moléculas importan Átomos, Organismos importan Moléculas y Átomos).
- **IMPORTACIONES ABSOLUTAS:** SIEMPRE usar importaciones absolutas con alias `$lib`: `$lib/components/01-atoms/Button.svelte`
- **ÍNDICES DE BARRIL:** Usar índices de barril (`$lib/components/01-atoms/index.ts`) para exportar componentes y mantener importaciones limpias.

# Estructura de Componentes
- **PROPS:** Usar `$props()` desestructurado con valores por defecto: `let { prop = defaultValue }: Props = $props();`
- **RUNES:** Usar `$state` para estado interno, `$derived` para valores computados, `$effect` para efectos secundarios
- **EVENTOS:** Usar callback props en lugar de `createEventDispatcher` para átomos/moléculas simples
- **SLOTS:** Usar tipo `Snippet` de Svelte 5 para tipado de slots: `children: import('svelte').Snippet`

# Tokens de Diseño
- **ALTOCOST:** NUNCA usar valores literales de color/texto (ej: `text-black`, `bg-red-500`)
- **USAR:** Tokens semánticos (ej: `text-text-default`, `bg-surface-card`, `border-border-default`)
- **EXCEPCIÓN:** `currentColor` y valores de Tailwind en `app.css` para definir tokens primitivos

# Accesibilidad (A11y)
- **ROLES:** Agregar roles ARIA apropiados cuando sea necesario (ej: `role="status"` para loaders)
- **LABELS:** Usar `aria-label` para elementos sin texto visible
- **FOCUS:** Usar la utilidad `useFocus()` de `$lib/utils/focus.ts` para gestión de foco programático
- **TRAP FOCUS:** Usar `trapFocus()` para modales y dropdowns
- **SCREEN READERS:** Incluir texto oculto con `sr-only` cuando sea necesario

# Testing (Futuro)
- **ESTRUCTURA:** Los tests deben estar junto a los componentes: `Component.svelte` y `Component.test.ts`
- **COBERTURA:** Priorizar tests de componentes críticos (formularios, navegación, modales)
- **HERRAMIENTAS:** Usar Vitest + Testing Library cuando se configure testing

# Performance
- **CODE SPLITTING:** Considerar importaciones dinámicas para componentes orgánicos pesados
- **LAZY LOADING:** Usar `onMount` + importación dinámica para componentes que no se necesitan inmediatamente

